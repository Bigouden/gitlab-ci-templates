variables:
  CONTAINER_CLIENT_IMAGE: alpine:latest
  CONTAINER_GITLEAKS_IMAGE: zricethezav/gitleaks:latest
  CONTAINER_SEMGREP_IMAGE: returntocorp/semgrep:latest
  CONTAINER_ANSIBLE_IMAGE: $CI_REGISTRY/bigouden/alpine-ansible:daily
  GIT_DEPTH: 1
  FF_DISABLE_UMASK_FOR_DOCKER_EXECUTOR: "true"

Ansible Lint:
  stage: Quality
  needs: []
  image: 
    name: $CONTAINER_ANSIBLE_IMAGE
    entrypoint: ['']
  script:
    - ansible-lint
  rules:
    - exists:
        - "**/ansible.cfg"
        - "**/hosts"

Pylint:
  stage: Quality
  needs: []
  image: $CONTAINER_CLIENT_IMAGE
  before_script:
    - apk add --no-cache --update git py3-pip
    - pip install pylint
  dependencies: []
  script:
    - find . -type f -name "*.py" | xargs pylint 
  rules:
    - exists:
        - "**/*.py"

Shellcheck:
  stage: Security
  needs: []
  image: $CONTAINER_CLIENT_IMAGE
  before_script:
    - apk add --no-cache --update shellcheck
  dependencies: []
  script:
    - find . -type f -name "*.sh" | xargs shellcheck 
  rules:
    - exists:
        - "**/*.sh"

Gitleaks:
  stage: Security
  needs: []
  image: 
    name: $CONTAINER_GITLEAKS_IMAGE
    entrypoint: [""]
  script:
    - gitleaks detect --source . -v
  variables:
    GIT_DEPTH: 0

Semgrep:
  stage: Security
  needs: []
  image: $CONTAINER_SEMGREP_IMAGE
  script: 
    - semgrep ci --config auto --force-color
